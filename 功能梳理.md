## 功能梳理

### 已开发功能

#### 我的界面Menu

1. 公共Menu

   邀请、会员中心、新手指南、反馈意见、关于我们、设置

2. 管理员

   机构、老师、班级、绑定手机号

3. 老师

   机构、班级、绑定手机号

4. 家长

   子女Menu、绑定学号、绑定手机号

5. 学生

   机构、老师、班级



#### 登录

1. 微信登录、学号登录

   1. 头像 （可修改）
      1. 微信头像
      2. 从相册选择
      3. 拍照
   2. 昵称（可修改）
      1. 微信昵称
      2. 自定义

2. 登录成功

   1. 有角色信息

      加载初始数据

      * 管理员
        * 所有自己创建机构的学员
        * 所有自己创建机构的entry
        * 所有自己创建的机构
        * 获取自己的匿名机构
      * 老师
        * 所有自己所教授的学员
        * 老师id是自己的所有entry
        * 所有自己所在的机构
        * 获取自己的匿名机构
      * 家长
        * 自己所有的孩子以及孩子的同学（同学: 上相同课程的学员）
        * 学号是自己所有的孩子以及孩子的同学的entry
        * 所有自己孩子所在的机构
        * 获取自己的匿名机构
      * 学生
        * 自己的所有同学
        * 学号是自己和同学的entry
        * 自己所在的机构

   2. 无角色信息

      弹窗选择角色

3. 角色变更

   1. 点击角色标签确定角色
   2. 管理员、老师、家长角色可以叠加
   3. 角色变更后
      1. tab页面中：课程、学员、我的中的数据随之变更
      2. 二级页面根据角色加载对应数据 （在具体的二级页面描述加载的具体数据）

4. 设置个性签名

5. 机构列表

   添加机构成功或机构信息更新成功后，机构列表卡片信息需要随之更新

   1. 管理员
      * 显示添加机构按钮
      * 加载所有自己创建的机构 （非匿名机构）
      * 点击机构卡片进入机构详情
   2. 老师
      * 隐藏添加机构按钮
      * 加载所有自己所在的机构 （非匿名机构）
      * 点击机构卡片进入机构详情
   3. 家长 （通过孩子->机构进入）
      * 隐藏添加机构按钮
      * 加载孩子所在的所有机构（非匿名机构）
      * 点击机构卡片进入机构详情
   4. 学生
      * 隐藏添加机构按钮
      * 加载自己所在的所有机构（非匿名机构）
      * 点击机构卡片进入机构详情

6. 创建机构|机构详情

   * 创建机构
     * 通过创建机构按钮进入
     * 设置机构图标、外观、名称、地址、简介、创建日期
   * 机构详情
     * 通过机构卡片进入
     * 只有该机构管理员能更新
     * 非机构管理员隐藏更新按钮且机构信息不可编辑
     * 更新机构图标、外观、名称、地址、简介、创建日期

7. 老师列表

   添加老师或更新老师信息成功后，老师列表数据随之更新

   添加老师按钮只在拥有管理员角色并且不是从孩子页面路由进来时才显示

   * 从机构详情进入
     * 加载该机构的所有老师
   * 家长从孩子页面进入
     * 加载所有教孩子的老师

   * 管理员
     * 加载所有自己创建机构的老师
   * 学生
     * 加载自己的所有老师

8. 老师卡片

   * 显示老师的头像、昵称、手机号、个性签名
   * 课程进度视图
     * 从机构详情进入老师列表时不显示
     * 家长从孩子页面进入老师列表时不显示
     * 角色是学生时不显示
     * 从我的页面进入、有管理员角色且有排课数据时显示
     * 进度为自己教的所有课程的已授课时总数/总课时数
   * 机构名称
     * forStudent = true
       * 老师所在的所有机构名称连接 （不超过3个）
     * forStudent = false
       * 自己所创建的所有机构名称连接 （不超过3个）
     * 匿名机构取创建者的名字

9. 添加老师

   * 加载自己创建的所有机构及机构老师
   * 机构名称
     * 普通机构显示机构名称；匿名机构显示机构创建者名称
   * 加载已经添加到机构的老师
   * 从本地文件里加载被邀请的老师 (邀请信息有效时长两小时)
   * 可以删除邀请信息
   * 通过微信发送邀请信息
   * 通过老师姓名及手机号来邀请老师
     * 邀请信息不能重复 （通过orgId、老师姓名、手机号来验证）
     * 不能邀请已经添加到该机构的老师（通过orgId、老师姓名、手机号来验证）
   * 各机构的老师邀请信息在界面退出时保存到文件

### 待开发功能

1. 用户服务协议
2. 会员相关功能
3. 创建机构|机构详情
   * 添加老师
   * 添加学员
   * 添加课程
   * 添加班级
4. 老师课程详情
5. 老师排课详情
6. 添加老师
   1. 被邀请用户接受邀请
      * 被邀请用户定位到我的页面
      * 在我的页面获取邀请方机构id，被邀请人的手机号
      * 如果是新用户，则引导用户登录
      * 登录成功后，引导用户绑定手机号
      * 绑定手机号成功后，引导用户是否接受邀请
      * 用户接受邀请后，将用户id添加到邀请方机构的老师集合中
      * 如果是老用户，在用户登录成功后，根据是否绑定了手机号，引导接受邀请流程
   2. 未过期的被邀请老师，如果已被添加到了该机构的老师集合中，则删除邀请信息中相应的邀请记录

