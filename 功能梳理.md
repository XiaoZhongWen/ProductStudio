## 功能梳理

### 已开发功能

#### 我的界面Menu

1. 公共Menu

   邀请、会员中心、新手指南、反馈意见、关于我们、设置

2. 管理员

   机构、老师、班级、绑定手机号

3. 老师

   机构、班级、绑定手机号

4. 家长

   子女Menu、绑定学号、绑定手机号

5. 学生

   机构、老师、班级



#### 登录

1. 微信登录、学号登录

   * 头像 （可修改）

     * 微信头像

     * 从相册选择
     * 拍照

   * 昵称（可修改）
      * 微信昵称

      * 自定义

2. 登录成功

   * 有角色信息

     加载初始数据

     * 管理员
       * 所有自己创建机构的学员
       * 所有自己创建机构的entry
       * 所有自己创建的机构
       * 获取自己的匿名机构
     * 老师
       * 所有自己所教授的学员
       * 老师id是自己的所有entry
       * 所有自己所在的机构
       * 获取自己的匿名机构
     * 家长
       * 自己所有的孩子以及孩子的同学（同学: 上相同课程的学员）
       * 学号是自己所有的孩子以及孩子的同学的entry
       * 所有自己孩子所在的机构
       * 获取自己的匿名机构
     * 学生
       * 自己的所有同学
       * 学号是自己和同学的entry
       * 自己所在的机构

   * 无角色信息

     弹窗选择角色

3. 角色变更

   * 点击角色标签确定角色

   * 管理员、老师、家长角色可以叠加

   * 角色变更后

     * tab页面中：课程、学员、我的中的数据随之变更

     * 二级页面根据角色加载对应数据 （在具体的二级页面描述加载的具体数据）

4. 设置个性签名

5. 机构列表

   添加机构成功或机构信息更新成功后，机构列表卡片信息需要随之更新

   * 管理员

     * 显示添加机构按钮

     * 加载所有自己创建的机构 （非匿名机构）

     * 点击机构卡片进入机构详情

   * 老师

     * 隐藏添加机构按钮

     * 加载所有自己所在的机构 （非匿名机构）

     * 点击机构卡片进入机构详情

   * 家长 （通过孩子->机构进入）

     * 隐藏添加机构按钮

     * 加载孩子所在的所有机构（非匿名机构）

     * 点击机构卡片进入机构详情

   * 学生

     * 隐藏添加机构按钮

     * 加载自己所在的所有机构（非匿名机构）

     * 点击机构卡片进入机构详情

6. 创建机构|机构详情

   * 创建机构
     * 通过创建机构按钮进入
     * 设置机构图标、外观、名称、地址、简介、创建日期
   * 机构详情
     * 通过机构卡片进入
     * 只有该机构管理员能更新
     * 非机构管理员隐藏更新按钮且机构信息不可编辑
     * 更新机构图标、外观、名称、地址、简介、创建日期

7. 老师列表

   添加老师或更新老师信息成功后，老师列表数据随之更新

   添加老师按钮只在拥有管理员角色并且不是从孩子页面路由进来时才显示

   * 从机构详情进入
     * 加载该机构的所有老师
   * 家长从孩子页面进入
     * 加载所有教孩子的老师

   * 管理员
     * 加载所有自己创建机构的老师
   * 学生
     * 加载自己的所有老师

8. 老师卡片

   * 显示老师的头像、昵称、手机号、个性签名
   * 课程进度视图
     * 从机构详情进入老师列表时不显示
     * 家长从孩子页面进入老师列表时不显示
     * 角色是学生时不显示
     * 从我的页面进入、有管理员角色且有排课数据时显示
     * 进度为自己教的所有课程的已授课时总数/总课时数
   * 机构名称
     * forStudent = true
       * 老师所在的所有机构名称连接 （不超过3个）
     * forStudent = false
       * 自己所创建的所有机构名称连接 （不超过3个）
     * 匿名机构取创建者的名字

9. 添加老师

   * 加载自己创建的所有机构及机构老师
   * 机构名称
     * 普通机构显示机构名称；匿名机构显示机构创建者名称
   * 加载已经添加到机构的老师
   * 从本地文件里加载被邀请的老师 (邀请信息有效时长两小时)
   * 可以删除邀请信息
   * 通过微信发送邀请信息
   * 通过老师姓名及手机号来邀请老师
     * 邀请信息不能重复 （通过orgId、老师姓名、手机号来验证）
     * 不能邀请已经添加到该机构的老师（通过orgId、老师姓名、手机号来验证）
   * 各机构的老师邀请信息在界面退出时保存到文件

10. 班级列表

​    添加班级按钮只在拥有管理员或老师角色并且不是从孩子页面进入时才显示

   * 从机构详情进入班级列表
     * 加载该机构的所有班级

   * 管理员|老师
     * 加载自己所创建机构和自己所在机构的所有班级
   * 家长从孩子页面进入班级列表
     * 加载自己孩子所在机构的所属班级
   * 学生
     * 加载自己所在机构的所属班级

11. 班级卡片

    * 显示班级图标、名称、授课老师、学员、机构
    * 显示班级课程

12. 添加|更新班级

    * 通过添加班级按钮进入，则添加班级
    * 通过点击班级卡片进入，如果是班级所在机构的管理员，则更新班级；否则查看班级详情
    * 若添加班级，则加载自己所创建的所有机构及机构的所有班级
    * 若更新班级，则加载相应机构及机构的所有班级
    * 添加|更新班级时可以设置班级图标、名称、课程、老师、学员、描述信息
    * 添加班级时要保存班级记录到数据库，同时需要将班级记录id添加到相应的机构班级集合中；内存及数据库同步更新
    * 更新班级时，需要更新数据库及内存中的班级信息
    * 添加|更新班级记录成功后，班级列表数据也需要同步更新
    * 添加班级学员时，只能邀请绑定了相应课程的学员
    * 不能重复添加同一个学员
    * 移除班级学员时，只能移除已添加到班级的学员

13. 绑定手机号|学号

    判断绑定类型设置相应title

    * 绑定学号时，必须有家长角色
    * 绑定学号组件，加载已绑定了的学员信息
    * 绑定学号组件，通过学号进行绑定
    * 提示绑定的学号必须是八位数字
    * 绑定学号时，将自己的id添加到学员的associateIds字段中去
    * 如果绑定的学号不存在，需要给出提示
    * 可以解除绑定

14. 退出登录

    清空所有store数据

15. 课程列表

    添加课程按钮只在拥有管理员、老师角色时显示

    * 管理员
      * 加载自己所创建机构的所有课程 （包含匿名机构）
    * 老师
      * 加载所有教授的课程以及自己匿名机构的所有课程
    * 家长
      * 加载小孩上的所有课程
    * 学生
      * 加载自己上的所有课程

16. 课程卡片

    * 显示课程图标、时长、次数、机构名称、类型、进度

    * 时长：一节课时长

    * 次数：次课，总课次数

    * 机构名称：普通机构显示机构名称，匿名机构显示创建者名称

    * 进度

      * 管理员

        该课程该机构的所有学员的总耗课数/总课数

      * 老师

        <font color='red'>bug</font> 该课程该老师的所有学员的总耗课数/总课数

      * 家长

        <font color='red'>bug</font> 该课程该家长的小孩的总耗课数/总课数

      * 学员

        <font color='red'>bug</font> 该课程该学员的总耗课数/总课数

17. 添加课程列表

    <font color='red'>bug</font> 管理员只能够给自己所创建的机构添加课程

    <font color='red'>bug</font> 老师只能给自己的匿名机构添加课程

    * 管理员

      <font color='red'>bug</font> 加载自己所创建的机构

    * 老师

      <font color='red'>bug</font> 加载自己的匿名机构

18. 添加课程卡片

    * 普通机构显示机构图标、机构名称
    * 匿名机构显示创建者头像、创建者昵称
    * 加载机构的所有课程
    * 添加|更新课程时可以编辑课程图标、类型、时长、简介
    * <font color='red'>bug</font> 对于次课，不需要编辑课程次数
    * 选中已添加的课程，可以编辑该课程信息
    * 再次点击已选中的课程，则状态由更新变为添加
    * 添加课程
      * 课程表中保存要添加的课程记录
      * 机构表中更新该机构的课程id集合
      * <font color='red'>bug</font> 以上两步在同一个接口中完成
      * 同步更新内存数据
    * 更新课程
      * 更新课程表中相应的记录
      * 同步更新内存数据
    * 删除课程
      * 长按已添加的课程，则显示删除课程按钮
      * <font color='red'>bug</font> 再次点击课程，隐藏删除课程按钮，状态变为更新状态
      * 点击删除课程按钮，开始删除课程
        * <font color='red'>bug</font> 如果已有学员绑定该课程且总课时数不为0，则提示不能删除
        * 课程表中删除该课程记录
        * 机构表中更新该机构的课程id集合
        * <font color='red'>bug</font> 以上两步在同一个接口中完成
        * 同步更新内存数据

19. 学员列表

    添加学员按钮只在拥有管理员、老师角色时显示

    * 管理员

      加载自己创建的机构的所有学员

    * 老师

      加载所有自己教的学员和自己匿名机构的学员

    * 家长 - 只有家长角色

      加载孩子和孩子的同学

    * 学员

      加载自己和自己的同学

20. 学员卡片

    显示学员的头像、昵称、学号、签名、总课程进度、所在机构名称

    * 课程总数大于0时，显示课程进度；否则显示绑定课程

    * 课程进度

      * 管理员

        学员在自己所创建的机构中消耗的课时/课时总数

      * 老师

        学员在自己的匿名机构中和自己所教授的课程中消耗的课时/课时总数

      * 家长|学员

        学员消耗的课时总数/总课时数

    * 所在机构名称

      * 管理员

        学员所属的在自己所创建的机构的名称叠加，若是匿名机构则为机构创建者昵称

      * 老师

        学员所属的在自己所创建的匿名机构和自己所属的机构名称叠加，匿名机构为机构创建者昵称

      * 家长|学员

        学员所属的所有机构的名称叠加，若是匿名机构则为机构创建者昵称

21. 添加学员

    * 管理员|老师

      加载自己创建的所有机构

22. 添加学员卡片

    * 普通机构显示机构图标、匿名机构显示创建者头像

    * 普通机构显示机构名称、匿名机构显示创建者昵称

    * 加载机构的所有学员

    * 添加学员

      * 不能重复添加学员 （通过name+phoneNumber的md5检查唯一性）

      * 学生表添加学生记录

      * 机构表中相应机构的学生id集合更新

      * <font color='red'>bug</font> 以上两步在同一个接口中完成

      * 同步更新内存数据

23. 绑定课程

    * 角色是管理员或老师并且指定机构中包含自己所创建的机构才能绑定课程
    * 能够绑定课程，title为绑定课程，显示绑定课程section；否则title为课程，不显示绑定课程section

    * 获取学员在指定机构所绑定的课程entry
    * 课程section显示该学员在指导机构所绑定的课程信息
    * 绑定课程section，编辑待绑定的课程信息
    * 不能给学员绑定相同的课程

24. 绑定课程卡片

    * 显示课程的图标、名称、状态、进度
    * <font color='red'>bug</font> 课程状态为在读且课程类型不是次课时显示课程时长
    * 课程状态为在读是显示授课老师
    * 是机构的创建者、有管理员或老师角色且机构老师数大于1时，显示可更换老师图标，点击图标可更换老师
    * <font color='red'>bug</font>  选择老师组件为单选状态，选中老师后，右上角显示确定按钮，点击确定可更换老师
    * 更换老师时，更新wk-mapping表相应记录，同时更新内存对象
    * 当课程状态不为在读时，显示操作人、操作时间信息
    * 是机构的创建者、有管理员或老师角色且课程状态不为退课时，显示操作按钮
    * 操作按钮中显示续课按钮；当课程状态是结课时，结课按钮为已结课，隐藏退课按钮；当课程状态是退课时，退课按钮为已退课，隐藏结课按钮；
    * <font color='red'>bug</font> 显示机构名称、课程类型

25. 绑定课程详情

    * 显示课程图标、名称、进度（特定学员的课程进度）、学员、授课老师，机构名称、课程类型
    * 课程记录列表
      * 指定学员在该课程上的所有课程记录
      * 显示记录状态
      * 非正常状态时，显示操作人、操作时间
      * <font color='red'>bug</font> 显示开始时间、结束时间、消课课时；次课显示消课课次
      * 显示课程内容、课后作业、课程反馈
      * 是自己机构的课程并且不是撤销状态，则显示操作按钮
      * <font color='red'>bug</font> 点击编辑按钮，可编辑开始时间、结束时间、消耗课时|课次、课程内容、课后作业、课程反馈
      * 编辑|撤销课程记录，要更新课程记录表、wk-mapping表相应记录、同步更新内存信息
      * <font color='red'>bug</font> 以上两个数据库表操作要在同一个接口中完成
    * 续课记录列表
      * 指定学员在该课程上的所有续费记录
      * 显示记录状态
      * 非正常状态时，显示操作人、操作时间信息
      * <font color='red'>bug</font> 显示续课时间、续课时数；次课则显示续课次数、课程价格、备注
      * 是自己机构的课程并且不是撤销状态，则显示操作按钮
      * <font color='red'>bug</font> 点击编辑按钮，可编辑续课记录；可编辑续课时间、续课时|次数、价格、备注信息
      * 编辑|撤销续课记录时，要更新缴费表相应记录、wk-mapping表相应记录、同步更新内存信息
      * <font color='red'>bug</font> 以上两个数据库表操作要在同一个接口中完成
      * <font color='red'>bug</font> 撤销续课记录时，要添加撤销记录到缴费表，不能更新原缴费记录

26. 课程续费

    * 显示学员头像、昵称、学号
    * 是普通机构时，显示机构名称
    * 显示课程图标、名称
    * 显示授课老师图标
    * 显示课程类型、剩余课时|课次数
    * 显示课时|课次单价，可编辑
    * 续课时|次数，可编辑
    * 备注，可编辑
    * 课程续费，要更新缴费表相应记录、wk-mapping表相应记录、同步更新内存信息
    * <font color='red'>bug</font> 以上两个数据库表操作要在同一个接口中完成

27. 课程结课

    * 结课时检查剩余课时|次数是否为0，不为0则不能结课
    * 结课时更新课程状态信息，更新wk-maping表记录，同步更新内存数据

28. 课程退课

    * 退课时检查剩余课时|次数是否为0，为0则提示用户去结课
    * 退课时更新wk-maping表记录
    * <font color='red'>bug</font> 退课时新增退课的缴费记录表
    * <font color='red'>bug</font> 以上两个数据库表操作要在同一个接口中完成
    * 同步更新内存数据

### 待开发功能

1. 用户服务协议

2. 会员相关功能

3. 创建机构|机构详情
   * 添加老师
   * 添加学员
   * 添加课程
   * 添加班级

4. 老师课程详情

5. 老师排课详情

6. 添加老师

   * 被邀请用户接受邀请

     * 被邀请用户定位到我的页面

     * 在我的页面获取邀请方机构id，被邀请人的手机号

     * 如果是新用户，则引导用户登录

     * 登录成功后，引导用户绑定手机号

     * 绑定手机号成功后，引导用户是否接受邀请

     * 用户接受邀请后，将用户id添加到邀请方机构的老师集合中

     * 如果是老用户，在用户登录成功后，根据是否绑定了手机号，引导接受邀请流程

   * 未过期的被邀请老师，如果已被添加到了该机构的老师集合中，则删除邀请信息中相应的邀请记录

7. 班级卡片|添加学员卡片|添加|更新班级

   * 点击学员头像进入学员详情页面

8. 绑定手机号

9. 邀请

10. 会员中心

11. 新手指南

12. 反馈意见

13. 关于我们

14. 设置

15. 课程卡片

    点击课程卡片进入课程详情

    课程详情

    * 课程基本信息
    * 各老师的课程进度
    * 各学员的课程进度

16. 绑定课程详情

    * 请假记录
